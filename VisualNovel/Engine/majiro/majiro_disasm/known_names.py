from .crc import Crc

SYSCALL_GROUP = "MAJIRO_INTER"
SYSCALL_SUFFIX = "@" + SYSCALL_GROUP

# Known syscall names
KNOWN_SYSCALL_NAMES = [
    "abs",
    "atoi",
    "change_cursor",
    "chr$",
    "client_height",
    "client_width",
    "clipbord_is_change",
    "cos%",
    "crc32str",
    "debugout",
    "debugout_dialog",
    "dialog_ask_ok",
    "dialog_ask_okcancel",
    "dialog_ask_yesno",
    "dialog_error_ok",
    "dialog_error_okcancel",
    "dialog_error_retrycancel",
    "dialog_error_yesno",
    "dialog_input$",
    "dialog_ok",
    "dialog_okcancel",
    "dialog_retrycancel",
    "dialog_warning_ok",
    "dialog_warning_okcancel",
    "dialog_warning_retrycancel",
    "dialog_warning_yesno",
    "dialog_yesno",
    "dim_copy%#",
    "dim_copy#",
    "dim_copy$#",
    "dim_create%#",
    "dim_create#",
    "dim_create$#",
    "dim_release%#",
    "dim_release#",
    "dim_release$#",
    "drag_accept_files",
    "file_close",
    "file_open",
    "file_puts",
    "file_read",
    "file_read_line_raw$",
    "file_read_line$",
    "file_read$",
    "file_write_open",
    "force_key_paste",
    "get_clipbord$",
    "get_drag_filename$",
    "get_frontbuffer",
    "get_system_default_lcid",
    "get_variable",
    "get_variable_nowarn",
    "get_variable_nowarn$",
    "get_variable$",
    "is_log_no_pic",
    "is_log_no_voice",
    "is_report_no_pic",
    "is_report_no_voice",
    "is_testplay",
    "itoa$",
    "max",
    "min",
    "num_strsplit",
    "open_help",
    "rand",
    "rand!",
    "reg_read",
    "reg_read$",
    "reg_write",
    "reg_write_string",
    "regist_arcfile",
    "release_arcfile",
    "set_clipbord",
    "set_fast_mode_flg",
    "set_frontbuffer",
    "set_syukusyou",
    "set_variable",
    "set_wallpaper",
    "set_watchlist",
    "sin%",
    "speed_setup_dialog",
    "strcmp",
    "strdate$",
    "stricmp",
    "strleft$",
    "strlen",
    "strlwr$",
    "strmatch",
    "strmid$",
    "strright$",
    "strsplit$",
    "strstr",
    "strtime$",
    "strupr$",
    "tan%",
    "timer",
    "timer_progress",
    "volume_setup_dialog",
    "web_access",
    "write_pic_cache",
    "get_game_speed",
    "get_nanido",
    "set_com_end",
    "call",
    "call_sub",
    "call_sub_str",
    "do_event",
    "do_event_single",
    "event_hook",
    "event_hook_after",
    "event_release",
    "exec",
    "exec_func",
    "load_library",
    "is_auto_mode",
    "is_fast_mode",
    "draw_wait",
    "exit",
    "fast_mode_config",
    "get_fast_stat",
    "is_read",
    "mk_read",
    "mk_unwait",
    "mk_wait",
    "reset_exec",
    "reset_fast_mode",
    "reset_ultra_fast_mode",
    "screen_mode",
    "set_auto_mode",
    "set_fast_mode",
    "set_fast_mode_ar",
    "set_fast_mode_force",
    "set_fast_stat",
    "set_ultra_fast_mode",
    "show_mouse_cursor",
    "thread_begin",
    "thread_begin_child",
    "thread_end",
    "time_accera",
    "timer_sync",
    "wait",
    "console_cls",
    "console_color",
    "console_curpos_x",
    "console_curpos_y",
    "console_dispose",
    "console_font",
    "console_font_height_get",
    "console_hist_pos",
    "console_is_on",
    "console_locate",
    "console_locate_force",
    "console_next",
    "console_next_wipe",
    "console_num_hist",
    "console_num_hist_wipe",
    "console_off",
    "console_on",
    "console_prev",
    "console_prev_wipe",
    "console_redraw",
    "console_replay",
    "console_resetzerotime",
    "console_set",
    "console_setzerotime",
    "fontout",
    "fontout_color",
    "fontout_font",
    "fontout_locate",
    "fontout_pop",
    "fontout_push",
    "get_last_line_msg$",
    "get_last_msg$",
    "histbuff_clear",
    "histbuff_disable",
    "histbuff_enable",
    "load_font",
    "set_font_cache",
    "set_voice_male",
    "set_voice_skip",
    "voicerect_height",
    "voicerect_name$",
    "voicerect_name_alt$",
    "voicerect_num",
    "voicerect_top",
    "fuchidori_copy",
    "full_screen_height",
    "full_screen_width",
    "get_alfapage",
    "grp_alfa_tabled_copy",
    "grp_boxfill",
    "grp_copy",
    "grp_extboxfill",
    "grp_extcopy",
    "grp_home",
    "grp_modcopy",
    "grp_modify_copy",
    "grp_mulboxfill",
    "grp_mulcopy",
    "grp_overlayboxfill",
    "grp_point_get",
    "grp_point_set",
    "grp_reverse",
    "grp_revmulcopy",
    "grp_sepia",
    "grp_swap",
    "grp_zoom",
    "make_alfa_table",
    "make_mosaic",
    "movie_play",
    "movie_play_fromto",
    "movie_play_repeat",
    "movie_stat",
    "movie_stop",
    "movie_texture",
    "movie_texture_play",
    "movie_texture_stop",
    "movie_texture_volume",
    "movie_volume",
    "movie_wait",
    "page_create",
    "page_create_file",
    "page_create_file_withalfa",
    "page_create_withalfa",
    "page_drawmode",
    "page_is_exist",
    "page_len_x",
    "page_len_y",
    "page_release",
    "page_set_antidata",
    "pic_is_exist",
    "pic_key_set",
    "pic_len_x",
    "pic_len_y",
    "pic_unpack",
    "rgb",
    "rgba",
    "get_caps_stat",
    "joy_is_enable",
    "joy_set_enable",
    "kb_read",
    "keybd_disable",
    "keybd_enable",
    "set_caps_stat",
    "set_joy",
    "capture_thumbnail",
    "copy_current_thumbnail",
    "copy_save",
    "copy_thumbnail",
    "delete_save",
    "do_extload",
    "do_extsave",
    "do_load",
    "do_save",
    "enter_loadsave_menu",
    "get_current_info$",
    "get_current_time$",
    "get_save_info$",
    "get_save_time$",
    "is_save_menu_disable",
    "is_view",
    "leave_loadsave_menu",
    "make_thumbnail",
    "save_disable",
    "save_enable",
    "save_menu_disable",
    "save_menu_enable",
    "save_point",
    "set_save_info",
    "set_view",
    "loadsave_select_dialog",
    "areaevent_check",
    "areaevent_offs",
    "areaevent_reset",
    "areaevent_set",
    "areaevent_setdefault",
    "curpos_x",
    "curpos_y",
    "mk_stat",
    "do_mouse_capture",
    "mouse_capture_end",
    "mouse_capture_init",
    "set_mouse_capture_left",
    "set_mouse_capture_mid",
    "set_mouse_capture_right",
    "chk_is_tenpai",
    "com_set_agari",
    "com_set_tenpai",
    "get_yaku_stat",
    "pi_chi",
    "pi_kan",
    "pi_pon",
    "pi_sort",
    "get_player_pi",
    "pi_get",
    "all_setup_dialog",
    "font_dialog$",
    "get_autospeed",
    "get_effectspeed",
    "get_font_name$",
    "get_mojispeed",
    "get_voice_setup",
    "is_font_setup_anti",
    "is_font_setup_bold",
    "is_font_setup_fuchidori",
    "is_font_setup_shadow",
    "is_quickload_failsafe",
    "is_quicksave_failsafe",
    "is_talk_female",
    "is_talk_male",
    "is_voice_continue",
    "is_voice_musicdown",
    "is_voice_panning",
    "set_autospeed",
    "set_effectspeed",
    "set_font_name",
    "set_mojispeed",
    "set_musicvolume",
    "set_quickload_failsafe",
    "set_quicksave_failsafe",
    "set_soundvolume",
    "set_voicevolume",
    "voice_musicdown_vol",
    "voice_setup",
    "voice_text_setup",
    "extmusic",
    "extmusic_replace",
    "extsound",
    "extsound2",
    "extsound3",
    "extsound4",
    "music",
    "music_fade",
    "music_fadeout",
    "music_fadeout_wait",
    "music_pause",
    "music_pop",
    "music_push",
    "music_replace",
    "music_resume",
    "music_stat",
    "music_stat_reset",
    "music_stop",
    "music_vol",
    "music_wait",
    "sound",
    "sound2",
    "sound2_fade",
    "sound2_fadeout",
    "sound2_get_fn$",
    "sound2_is_loop",
    "sound2_pan",
    "sound2_stat",
    "sound2_stop",
    "sound2_vol",
    "sound2_wait",
    "sound3",
    "sound3_fade",
    "sound3_fadeout",
    "sound3_get_fn$",
    "sound3_is_loop",
    "sound3_pan",
    "sound3_stat",
    "sound3_stop",
    "sound3_vol",
    "sound3_wait",
    "sound4",
    "sound4_fade",
    "sound4_fadeout",
    "sound4_get_fn$",
    "sound4_is_loop",
    "sound4_pan",
    "sound4_stat",
    "sound4_stop",
    "sound4_vol",
    "sound4_wait",
    "sound_ch",
    "sound_ch_fade",
    "sound_ch_fadeout",
    "sound_ch_get_fn$",
    "sound_ch_pan",
    "sound_ch_stat",
    "sound_ch_stop",
    "sound_ch_vol",
    "sound_ch_wait",
    "sound_fade",
    "sound_fadeout",
    "sound_get_fn$",
    "sound_is_loop",
    "sound_pan",
    "sound_stat",
    "sound_stop",
    "sound_vol",
    "sound_wait",
    "voice",
    "voice_ch",
    "voice_ch_fade",
    "voice_ch_fadeout",
    "voice_ch_get_fn$",
    "voice_ch_pan",
    "voice_ch_stat",
    "voice_ch_stop",
    "voice_ch_vol",
    "voice_ch_wait",
    "voice_fade",
    "voice_fadeout",
    "voice_get_fn$",
    "voice_pan",
    "voice_raw",
    "voice_stat",
    "voice_stop",
    "voice_vol",
    "voice_wait",
    "invalidate_disable",
    "invalidate_enable",
    "invalidate_rect",
    "sprite_alfa_define",
    "sprite_alfa_define_abs",
    "sprite_alfa_set",
    "sprite_alfa_wait",
    "sprite_animate_add",
    "sprite_animate_define",
    "sprite_animate_define_abs",
    "sprite_animate_wait",
    "sprite_clip",
    "sprite_create",
    "sprite_create_ext",
    "sprite_create_file",
    "sprite_create_file_ext",
    "sprite_get_page",
    "sprite_get_pos_x",
    "sprite_get_pos_y",
    "sprite_is_exist",
    "sprite_is_move",
    "sprite_len_x",
    "sprite_len_y",
    "sprite_move",
    "sprite_move_wait",
    "sprite_paste",
    "sprite_pop",
    "sprite_priority_high",
    "sprite_priority_high_single",
    "sprite_priority_low",
    "sprite_priority_low_single",
    "sprite_push",
    "sprite_release",
    "sprite_rotate",
    "sprite_set_smooth_animation",
    "sprite_tl_set",
    "sprite_xmodify_define",
    "sprite_xmodify_get%",
    "sprite_xmodify_set",
    "sprite_ymodify_define",
    "sprite_ymodify_get%",
    "sprite_ymodify_set",
    "sprite_page_auto_release",
    "dialog_ask_retrycancel",
    "auto_mode_config",
    "is_ultra_fast_mode",
    "mouse_enable",
    "ultra_fast_disable",
    "sound_is_exist",
    "thread_atend",
    "mouse_disable",
    "voice_is_exist",
    "fast_mode_disable",
    "prevsel_disable",
    "fast_mode_enable",
    "system_end",
    "ultra_fast_enable",
    "thread_is_exist",
    "prevsel_enable",
    "mouse_move",
    "mouse_move_inter",
    "read_pic_cache",
    "dim_release!#",
    "dim_create!#",
]

# Known group names
KNOWN_GROUP_NAMES = [
    "GLOBAL",
    "MAJIRO_INTER",
    "BOSSMODE",
    "BUTONMENU",
    "CARD",
    "CGMODE",
    "CHRONICLE",
    "CONFIG",
    "CONSOLE",
    "FREESEL",
    "GAIZI",
    "RES",
    "HELP",
    "HISTORY",
    "LOADSAVE",
    "SYSTEM",
    "MAPMAIN",
    "MAP",
    "MENU",
    "MSG_BOX",
    "MUSICMODE",
    "PIC",
    "RANKING",
    "SIGHT",
    "ENDING",
    "STAFFROOM",
    "TRANSIT",
    "USERTRANS",
    "KOEKOE",
    "ZUKAN",
    "TUMOMENU",
    "NAKIMENU",
    "ASK_KIRIPI",
    "RCLICK_MENU",
    "KOTITLE",
    "SAIKORO",
    "GAMECONTROL",
    "MINIGAME",
]

# Known function names (add more as discovered)
KNOWN_FUNCTION_NAMES = [
    "$trans_autoexec@PIC",
    "$user_voice@KOEKOE",
    "$trans_wait@PIC",
    "$trans@PIC",
    "$console_off@CONSOLE",
    "$console_on@CONSOLE",
    "$pause@CONSOLE",
    "$disp_char@PIC",
    "$disp_back@PIC",
    "$pic_top@PIC",
    "$buttonmenu@BUTONMENU",
    "$select@MENU",
    "$do_select@MENU",
    # Add more function names here as you encounter them
]

# Known variable names
KNOWN_VARIABLE_NAMES = [
    "@dc@KOEKOE",
    "@fc@KOEKOE",
    "@pausecancel@KOEKOE",
]


class KnownNames:
    @classmethod
    def get_syscall_name(cls, hash_val: int) -> str:
        return _SYSCALL_BY_HASH.get(hash_val)

    @classmethod
    def get_function_name(cls, hash_val: int) -> str:
        return _FUNCTION_BY_HASH.get(hash_val)

    @classmethod
    def get_variable_name(cls, hash_val: int) -> str:
        return _VARIABLE_BY_HASH.get(hash_val)


# Build hash tables on module load
_SYSCALL_BY_HASH = {}
for _name in KNOWN_SYSCALL_NAMES:
    _syscall = "$" + _name + SYSCALL_SUFFIX
    _hash_val = Crc.hash_32_string(_syscall)
    _SYSCALL_BY_HASH[_hash_val] = _name

_FUNCTION_BY_HASH = {}
# Add $main@GROUP for each group
for _group in KNOWN_GROUP_NAMES:
    _name = f"$main@{_group}"
    _hash_val = Crc.hash_32_string(_name)
    _FUNCTION_BY_HASH[_hash_val] = _name

# Add known function names
for _name in KNOWN_FUNCTION_NAMES:
    _hash_val = Crc.hash_32_string(_name)
    _FUNCTION_BY_HASH[_hash_val] = _name

_VARIABLE_BY_HASH = {}
for _name in KNOWN_VARIABLE_NAMES:
    _hash_val = Crc.hash_32_string(_name)
    _VARIABLE_BY_HASH[_hash_val] = _name
